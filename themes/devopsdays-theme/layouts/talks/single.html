{{ define "main" }}

<h2>Talks</h2>

{{ .Content }}

{{- $.Scratch.Set "first" "true" -}}
{{- with .Params.icons -}}
  {{- $.Scratch.Set "icons" (. | upper ) -}}
{{- end -}}

{{- $e := partial "functions/get-event-data" . -}}

{{- $p := index $.Site.Data.events (index (split (.Permalink | relURL) "/") 2) "program" -}}

{{ if eq $p nil }}
  {{ $p = $e }}
{{ end }}
 
{{- if $e.startdate -}}
{{ if (where (readDir (printf "content/events/%s/" $e.name)) "Name" "program") }}
{{ range os.ReadDir (printf "content/events/%s/program/" $e.name) }}
 {{ $filename :=  (printf "/events/%s/program/%s" $e.name  .Name) }}
  {{ with $.Site.GetPage $filename }}
  {{- if eq (index (split (.Permalink | relURL) "/") 2) $e.name -}}
    {{- $.Scratch.Set "base_file_name" .File.BaseFileName -}}
    {{- $.Scratch.Set .File.BaseFileName .Title -}}
    {{- $.Scratch.Set (printf "%s-content" ($.Scratch.Get "base_file_name")) .Content -}}
    {{- with .Params.vimeo -}}
      {{- $.Scratch.Set (printf "%s-video_link" ($.Scratch.Get "base_file_name")) (printf "https://player.vimeo.com/video/%s" .) }}
    {{- end -}}
    {{- with .Params.youtube -}}
      {{- $.Scratch.Set (printf "%s-video_link" ($.Scratch.Get "base_file_name")) (printf "https://www.youtube.com/embed/%s" .) }}
    {{- end -}}
    {{- with .Params.speakerdeck -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) . }}
    {{- end -}}
    {{- with .Params.slideshare -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) . }}
    {{- end -}}
    {{- with .Params.googleslides -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) (printf "https://docs.google.com/presentation/d/%s" .) }}
    {{- end -}}
    {{- with .Params.pdf -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) . }}
    {{- end -}}
    {{- with .Params.notist -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) (printf "https://noti.st/%s" .) }}
    {{- end -}}
    {{- with .Params.slideslive -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) (printf "https://slideslive.com/%s" .) }}
    {{- end -}}
    {{- with .Params.slides -}}
      {{- $.Scratch.Set (printf "%s-slides_link" ($.Scratch.Get "base_file_name")) . }}
    {{- end -}}
    {{- if isset .Params "speakers" -}}
      {{- if ne .Params.speakers "" -}}
        {{- $.Scratch.Set "speaker_len" (.Params.speakers | len) -}}
        {{- $.Scratch.Set "speaker_count" 0 -}}
      {{- end -}}
    {{- end -}}
    {{- range .Params.speakers -}}
      {{- $.Scratch.Set "speaker_count" (add ($.Scratch.Get "speaker_count") 1) -}}
      {{- $.Scratch.Set "speakername" . -}}
        {{/*  {{- range where $.Site.Pages "Type" "speaker" -}}
          {{- if eq (index (split (.Permalink | relURL) "/") 2) $e.name -}}  */}}
          {{ if (where (readDir (printf "content/events/%s/" $e.name)) "Name" "speakers") }}
            {{ range os.ReadDir (printf "content/events/%s/speakers/" $e.name) }}
              {{ $filename :=  (printf "/events/%s/speakers/%s" $e.name  .Name) }}
              {{ with $.Site.GetPage $filename }}
                {{- if eq .File.BaseFileName ($.Scratch.Get "speakername") -}}
                  {{- $.Scratch.Add (printf "%s-speaker" ($.Scratch.Get "base_file_name")) (slice .Title) -}}
                  {{- $.Scratch.Add (printf "%s-speaker-image" ($.Scratch.Get "base_file_name")) (slice .Params.image) -}}
                  {{- $.Scratch.Add (printf "%s-speaker-link" ($.Scratch.Get "base_file_name")) (slice .File.BaseFileName) -}}
                  {{- $.Scratch.Add (printf "%s-speaker-data" ($.Scratch.Get "base_file_name")) (slice (dict "name" .Title "image" .Params.image "link" .File.BaseFileName "bio" .Content)) -}}
                {{- end -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
          {{- end -}}
          {{- end -}}
  {{- end -}}
{{- end -}}
{{- end -}}

{{- with $p -}}
  {{- range .program -}}
    {{- $.Scratch.SetInMap "dates" .date .date -}}
  {{- end -}}
{{- end -}}

{{- range ($.Scratch.GetSortedMapValues "dates") -}}
  {{- $.Scratch.Set "date" . -}}
  {{- with $p -}}
    {{- if .program -}}
      {{- $program := (where .program "date" ($.Scratch.Get "date")) -}}
      {{- $program_len := (len $program) -}}
      {{- $.Scratch.Set "program_len" $program_len -}}
      {{- $.Scratch.Set "program_counter" 0 -}}
      {{- range where .program "date" ($.Scratch.Get "date") -}}
        {{- $.Scratch.Set "program_counter" (add ($.Scratch.Get "program_counter") 1) -}}
        {{- if or (eq .type "talk") (eq .type "workshop") -}}
          <div class = "row program-row">
            <div class="col-lg-12 col-md-12 program-element {{ printf "program-%s" .type }}" {{ if .background_color }}style="background-color: {{ .background_color }}"{{end}}>
              <div class="col-lg-9 col-md-6" style="float: left;">
                <b><a href='{{ (printf "/events/%s/program/%s" $e.name .title) }}'>{{ $.Scratch.Get .title }}</a></b><br>
                By&nbsp;
                {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                  <b><a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}</a></b>&nbsp;
                {{- end -}}
                <br>
                On&nbsp;<b>{{- dateFormat "Monday 2nd January 2006" ($.Scratch.Get "date") -}}</b><br>
                From&nbsp;<b>{{ .start_time }}</b>&nbsp;Until&nbsp;<b>{{ .end_time }}</b><br>
                {{- if eq  ($.Scratch.Get "icons")  "TRUE" -}}
                  {{- with ($.Scratch.Get (printf "%s-video_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-video-camera" aria-hidden="true"></i></a>&nbsp;{{- end -}}
                  {{- with ($.Scratch.Get (printf "%s-slides_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-file-text-o" aria-hidden="true"></i></a>&nbsp;{{- end -}}
                {{- end -}}
                <br><i>{{- $.Scratch.Get (printf "%s-content" .title) | markdownify -}}</i><br>
              </div>
              <div class="col-lg-3 col-md-6" style="float: right; text-align: right;">
                {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                  <a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}<br>
                  {{- $assetsfolder := (printf "assets/events/") -}}
                  {{- if eq (index $speakerdata "image") "" -}}
                    <img src = "/img/speaker-default.jpg" class="speakers-page"  alt="{{- index $speakerdata "name" -}}" width="236px"/><br />
                  {{- else if (where (readDir $assetsfolder) "Name" $e.name) -}}
                    {{- $assetspeakersfolder := (printf "assets/events/%s/speakers/" $e.name) -}}
                    {{- if (where (readDir $assetspeakersfolder) "Name" (index $speakerdata "image")) -}}
                      {{- $imagelocation := (printf "events/%s/speakers/%s" $e.name (index $speakerdata "image")) -}}
                      {{- $imageresource := resources.Get $imagelocation -}}
                      {{- $imagefile := $imageresource.Fit "600x600 webp Lanczos q100" -}}
                      <img src = '{{ $imagefile.RelPermalink }}' class="speakers-page" alt="{{ $.Title }}" width="236px"/><br />
                    {{- end -}}
                  {{- else -}}
                    <img src = '{{ (printf "/events/%s/speakers/" $e.name)  }}/{{- index $speakerdata "image" -}}' class='img-fluid' alt='{{- index $speakerdata "name" -}}' width="236px">
                  {{- end -}}
                  </a>
                  <br><i>{{- index $speakerdata "bio" | markdownify -}}</i></br>
                {{- end -}}
              </div>
            </div>
          </div>
        {{- end -}}
        {{- if eq .type "ignite" -}}
          {{- if .block -}}
            {{- $block := .block -}}
            {{- range $p.ignites -}}
              {{- if eq .block $block -}}
                <div class = "row program-row">
                  <div class="col-lg-12 col-md-12 program-element program-ignite" {{ if .background_color }}style="background-color: {{ .background_color }}"{{end}}>
                    <div class="col-lg-9 col-md-6" style="float: left;">
                      <a href="/events/{{ $e.name }}/program/{{ .title }}">{{ $.Scratch.Get .title }}</a><br>
                      By&nbsp;
                      {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                        <a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}</a><br>
                      {{- end -}}
                      On&nbsp;{{- dateFormat "Monday 2nd January 2006" ($.Scratch.Get "date") -}}<br>
                      From&nbsp;{{ .start_time }}&nbsp;Until&nbsp;{{ .end_time }}<br>
                      {{- if eq  ($.Scratch.Get "icons")  "TRUE" -}}
                        {{- with ($.Scratch.Get (printf "%s-video_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-video-camera" aria-hidden="true"></i></a>&nbsp;{{- end -}}
                        {{- with ($.Scratch.Get (printf "%s-slides_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-file-text-o" aria-hidden="true"></i></a>&nbsp;{{- end -}}
                      {{- end -}}
                    <br><i>{{- $.Scratch.Get (printf "%s-content" .title) | markdownify -}}</i><br>
                    </div>
                    <div class="col-lg-3 col-md-6" style="float: right; text-align: right;">
                      {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                        <a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}<br>
                        {{- $assetsfolder := (printf "assets/events/") -}}
                        {{- if eq (index $speakerdata "image") "" -}}
                          <img src = "/img/speaker-default.jpg" class="speakers-page"  alt="{{- index $speakerdata "name" -}}" width="236px"/><br />
                        {{- else if (where (readDir $assetsfolder) "Name" $e.name) -}}
                          {{- $assetspeakersfolder := (printf "assets/events/%s/speakers/" $e.name) -}}
                          {{- if (where (readDir $assetspeakersfolder) "Name" (index $speakerdata "image")) -}}
                            {{- $imagelocation := (printf "events/%s/speakers/%s" $e.name (index $speakerdata "image")) -}}
                            {{- $imageresource := resources.Get $imagelocation -}}
                            {{- $imagefile := $imageresource.Fit "600x600 webp Lanczos q100" -}}
                            <img src = '{{ $imagefile.RelPermalink }}' class="speakers-page" alt="{{ $.Title }}" width="236px"/><br />
                          {{- end -}}
                        {{- else -}}
                          <img src = '{{ (printf "/events/%s/speakers/" $e.name)  }}/{{- index $speakerdata "image" -}}' class='img-fluid' alt='{{- index $speakerdata "name" -}}' width="236px">
                        {{- end -}}
                        <a>
                        <br><i>{{- index $speakerdata "bio" | markdownify -}}</i></br>
                      {{- end -}}
                    </div>
              {{- end -}}
            {{- end -}}
          {{- else -}}
            {{- range where $p.ignites "date" ($.Scratch.Get "date") -}}
              {{- if not .block -}}
                <div class = "row program-row">
                  <div class="col-lg-12 col-md-12 program-element program-ignite" {{ if .background_color }}style="background-color: {{ .background_color }}"{{end}}>
                    <div class="col-lg-9 col-md-6" style="float: left;">
                      <a href="/events/{{ $e.name }}/program/{{ .title }}">{{ $.Scratch.Get .title }}</a><br>
                      By&nbsp;
                      {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                        <a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}</a><br>
                      {{- end -}}
                      On&nbsp;{{- dateFormat "Monday 2nd January 2006" ($.Scratch.Get "date") -}}<br>
                      From&nbsp;{{ .start_time }}&nbsp;Until&nbsp;{{ .end_time }}<br>
                      {{- if eq  ($.Scratch.Get "icons")  "TRUE" -}}
                        {{- with ($.Scratch.Get (printf "%s-video_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-video-camera" aria-hidden="true"></i></a>&nbsp;{{- end -}}
                        {{- with ($.Scratch.Get (printf "%s-slides_link" .title)) -}}&nbsp;<a href="{{ . }}"><i class="fa fa-file-text-o" aria-hidden="true"></i></a>&nbsp;{{- end -}}  
                      {{- end -}}
                      <br><i>{{- $.Scratch.Get (printf "%s-content" .title) | markdownify -}}</i><br>
                   </div>
                   <div class="col-lg-3 col-md-6" style="float: right; text-align: right;">
                     {{- range $speakerdata := ($.Scratch.Get (printf "%s-speaker-data" .title)) -}}
                       <a href='{{ (printf "/events/%s/speakers/%s" $e.name (index $speakerdata "link")) }}'>{{- index $speakerdata "name" -}}<br>
                       {{- $assetsfolder := (printf "assets/events/") -}}
                       {{- if eq (index $speakerdata "image") "" -}}
                         <img src = "/img/speaker-default.jpg" class="speakers-page"  alt="{{- index $speakerdata "name" -}}" width="236px"/><br />
                       {{- else if (where (readDir $assetsfolder) "Name" $e.name) -}}
                         {{- $assetspeakersfolder := (printf "assets/events/%s/speakers/" $e.name) -}}
                         {{- if (where (readDir $assetspeakersfolder) "Name" (index $speakerdata "image")) -}}
                           {{- $imagelocation := (printf "events/%s/speakers/%s" $e.name (index $speakerdata "image")) -}}
                           {{- $imageresource := resources.Get $imagelocation -}}
                           {{- $imagefile := $imageresource.Fit "600x600 webp Lanczos q100" -}}
                           <img src = '{{ $imagefile.RelPermalink }}' class="speakers-page" alt="{{ $.Title }}" width="236px"/><br />
                         {{- end -}}
                       {{- else -}}
                         <img src = '{{ (printf "/events/%s/speakers/" $e.name)  }}/{{- index $speakerdata "image" -}}' class='img-fluid' alt='{{- index $speakerdata "name" -}}' width="236px">
                       {{- end -}}
                       </a>
                       <br><i>{{- index $speakerdata "bio" | markdownify -}}</i></br>
                     {{- end -}}
                   </div>
                  </div>
                </div>
              {{- end -}}
            {{- end -}}
          {{- end -}}
          </div>
        </div>
      </div>
      </div>
      {{- end -}}
      </div>
    </div>
  </div>
  {{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
